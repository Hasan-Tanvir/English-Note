<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Notes - Auto-Sync Ready</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        h1 { color: #333; margin-bottom: 20px; }
        .step { background: #f8fafc; padding: 20px; border-radius: 10px; margin: 15px 0; border-left: 5px solid #667eea; }
        .btn { background: #10b981; color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin: 10px 5px; }
        .code { background: #1e293b; color: white; padding: 15px; border-radius: 8px; font-family: monospace; margin: 10px 0; overflow-x: auto; }
        .success { background: #d1fae5; color: #065f46; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .error { background: #fee2e2; color: #dc2626; padding: 10px; border-radius: 5px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ IELTS Notes - Auto-Sync Setup</h1>
        
        <div class="step">
            <h2>‚úÖ Step 1: Create Supabase Table</h2>
            <p>Run this SQL in Supabase SQL Editor:</p>
            <div class="code">
CREATE TABLE notes (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    user_id TEXT NOT NULL,
    data JSONB NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::text, NOW()) NOT NULL,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::text, NOW()) NOT NULL
);

-- Create index for faster queries
CREATE INDEX idx_notes_user_id ON notes(user_id);

-- Enable Row Level Security (optional)
ALTER TABLE notes ENABLE ROW LEVEL SECURITY;

-- Create policy to allow all operations (for testing)
CREATE POLICY "Allow all operations" ON notes FOR ALL USING (true);
            </div>
            <button class="btn" onclick="copySQL()">üìã Copy SQL</button>
        </div>
        
        <div class="step">
            <h2>üîß Step 2: Test Connection</h2>
            <p>Click to test your Supabase connection:</p>
            <button class="btn" onclick="testConnection()">Test Connection</button>
            <div id="test-result"></div>
        </div>
        
        <div class="step">
            <h2>üì± Step 3: Generate User ID</h2>
            <p>Your unique sync ID: <strong id="user-id">Click generate below</strong></p>
            <button class="btn" onclick="generateUserId()">Generate User ID</button>
            <button class="btn" onclick="copyUserId()">Copy ID for Phone</button>
        </div>
        
        <div class="step">
            <h2>üíæ Step 4: Quick Sync Demo</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
                <button class="btn" onclick="saveDemoData()">üíæ Save Demo Note</button>
                <button class="btn" onclick="loadFromCloud()">üì• Load from Cloud</button>
            </div>
            <div id="demo-result" style="margin-top: 15px;"></div>
        </div>
        
        <div class="step">
            <h2>üìñ Step 5: Launch Full App</h2>
            <p>Once table is created, launch the full IELTS Notes app:</p>
            <a href="full-app.html" style="display: inline-block; background: #3b82f6; color: white; padding: 15px 30px; border-radius: 8px; text-decoration: none; font-weight: bold; margin-top: 10px;">
                üöÄ Launch IELTS Notes App
            </a>
        </div>
    </div>
    
    <script>
        // Your Supabase credentials
        const SUPABASE_URL = 'https://popabtduwmotxilapiai.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_23tG3Xh2oLleEm77sCN7pg_5uwfWi-2';
        
        let userId = localStorage.getItem('ielts_user_id') || null;
        
        function copySQL() {
            const sql = `CREATE TABLE notes (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    user_id TEXT NOT NULL,
    data JSONB NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::text, NOW()) NOT NULL,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::text, NOW()) NOT NULL
);

CREATE INDEX idx_notes_user_id ON notes(user_id);

ALTER TABLE notes ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Allow all operations" ON notes FOR ALL USING (true);`;
            
            navigator.clipboard.writeText(sql)
                .then(() => alert('SQL copied! Paste in Supabase SQL Editor.'));
        }
        
        async function testConnection() {
            document.getElementById('test-result').innerHTML = '<div class="success">Testing connection...</div>';
            
            try {
                // Simple test using fetch
                const response = await fetch(SUPABASE_URL + '/rest/v1/', {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                if (response.ok) {
                    document.getElementById('test-result').innerHTML = 
                        '<div class="success">‚úÖ Connected to Supabase successfully!</div>';
                } else {
                    throw new Error('Failed to connect');
                }
            } catch (error) {
                document.getElementById('test-result').innerHTML = 
                    `<div class="error">‚ùå Connection failed. Make sure table exists.<br>Error: ${error.message}</div>`;
            }
        }
        
        function generateUserId() {
            if (!userId) {
                userId = 'ielts_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('ielts_user_id', userId);
            }
            document.getElementById('user-id').textContent = userId;
            return userId;
        }
        
        function copyUserId() {
            if (!userId) {
                userId = generateUserId();
            }
            navigator.clipboard.writeText(userId)
                .then(() => alert('User ID copied! Paste this on your phone app.'));
        }
        
        async function saveDemoData() {
            if (!userId) userId = generateUserId();
            
            const demoData = {
                vocab: [{word: "ubiquitous", meaning: "found everywhere", example: "Smartphones are ubiquitous in modern society."}],
                sentences: [{name: "Passive Voice", formula: "Subject + be + past participle", example: "The book was written by the author."}],
                timestamp: new Date().toISOString()
            };
            
            try {
                const response = await fetch(SUPABASE_URL + '/rest/v1/notes', {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=minimal'
                    },
                    body: JSON.stringify({
                        user_id: userId,
                        data: demoData,
                        updated_at: new Date().toISOString()
                    })
                });
                
                if (response.ok) {
                    document.getElementById('demo-result').innerHTML = 
                        '<div class="success">‚úÖ Demo note saved to cloud! Check on your phone.</div>';
                } else {
                    const error = await response.text();
                    throw new Error(error);
                }
            } catch (error) {
                document.getElementById('demo-result').innerHTML = 
                    `<div class="error">‚ùå Failed to save. Make sure table exists.<br>Run the SQL from Step 1.</div>`;
            }
        }
        
        async function loadFromCloud() {
            if (!userId) userId = generateUserId();
            
            try {
                const response = await fetch(
                    SUPABASE_URL + `/rest/v1/notes?user_id=eq.${userId}&select=*&order=updated_at.desc&limit=1`,
                    {
                        headers: {
                            'apikey': SUPABASE_KEY,
                            'Authorization': `Bearer ${SUPABASE_KEY}`
                        }
                    }
                );
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.length > 0) {
                        document.getElementById('demo-result').innerHTML = 
                            `<div class="success">‚úÖ Found ${data.length} note(s) in cloud!<br>Last updated: ${new Date(data[0].updated_at).toLocaleString()}</div>`;
                    } else {
                        document.getElementById('demo-result').innerHTML = 
                            '<div class="success">üì≠ No notes found in cloud. Save some first!</div>';
                    }
                } else {
                    throw new Error('Failed to load');
                }
            } catch (error) {
                document.getElementById('demo-result').innerHTML = 
                    `<div class="error">‚ùå Failed to load. Table might not exist.<br>Run Step 1 SQL first.</div>`;
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            if (userId) {
                document.getElementById('user-id').textContent = userId;
            }
            testConnection();
        });
    </script>
</body>
</html>
